---
import { useTranslations } from '../i18n/ui';

const t = useTranslations('es');

// Sample projects - replace with real project data
const projects = [
  {
    id: 'project-1',
    title: 'Sistema CRM Inmobiliario',
    category: 'Real Estate',
    client: 'Grupo Inmobiliario Premium',
    year: '2024',
    description: 'Plataforma integral para gestión de propiedades, leads y transacciones inmobiliarias con automatización de seguimiento.',
    challenge: 'El cliente manejaba más de 500 propiedades con Excel, perdiendo el 40% de leads por falta de seguimiento oportuno.',
    solution: 'Desarrollamos un CRM personalizado con automatización de emails, scoring de leads, y panel de analytics en tiempo real.',
    results: 'En 6 meses lograron triplicar sus conversiones y reducir el tiempo de cierre en un 60%.',
    image: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=800&h=600&fit=crop',
    stats: { leads: '+340%', time: '-60%', conversion: '+85%' },
    technologies: ['React', 'Node.js', 'MongoDB', 'AWS']
  },
  {
    id: 'project-2',
    title: 'Portal de Seguros Empresariales',
    category: 'Insurance',
    client: 'AseguraTech',
    year: '2024',
    description: 'Sistema de cotización y gestión de pólizas con integración a múltiples aseguradoras y panel de analytics avanzado.',
    challenge: 'Cotizar una póliza tomaba 2 días debido a la complejidad de comparar opciones manualmente entre 15 aseguradoras.',
    solution: 'Creamos un motor de cotización instantánea con APIs de aseguradoras, comparador visual y firma electrónica.',
    results: 'Reducción del tiempo de cotización de 2 días a 5 minutos, incrementando la capacidad de venta en un 400%.',
    image: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=800&h=600&fit=crop',
    stats: { policies: '+520', efficiency: '+75%', support: '-40%' },
    technologies: ['Next.js', 'Python', 'PostgreSQL', 'Azure']
  },
  {
    id: 'project-3',
    title: 'Plataforma E-commerce B2B',
    category: 'Commerce',
    client: 'DistribuMax',
    year: '2023',
    description: 'Marketplace empresarial con gestión de inventario en tiempo real, facturación automática y logística integrada.',
    challenge: 'Los pedidos se procesaban manualmente, generando errores de stock y retrasos en entregas que afectaban la relación con clientes.',
    solution: 'Implementamos un marketplace B2B con inventario sincronizado, reglas de precios por cliente y tracking de envíos.',
    results: 'Cero errores de inventario, procesamiento de pedidos 3x más rápido y satisfacción del cliente al 98%.',
    image: 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=800&h=600&fit=crop',
    stats: { orders: '+280%', stock: '99.9%', speed: '3x' },
    technologies: ['Vue.js', 'Laravel', 'MySQL', 'Redis']
  },
  {
    id: 'project-4',
    title: 'App de Telemedicina',
    category: 'Healthcare',
    client: 'MediConnect',
    year: '2023',
    description: 'Aplicación de consultas médicas virtuales con historial clínico, recetas digitales y agenda automatizada.',
    challenge: 'La pandemia saturó los centros médicos. Pacientes esperaban semanas para consultas que podían ser virtuales.',
    solution: 'Desarrollamos una app móvil y web con videoconsultas, expediente electrónico, recetas digitales y pagos integrados.',
    results: 'Más de 12,000 pacientes atendidos, reducción del 80% en tiempos de espera y expansión a 5 ciudades.',
    image: 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=800&h=600&fit=crop',
    stats: { patients: '+12K', waiting: '-80%', satisfaction: '98%' },
    technologies: ['React Native', 'Node.js', 'Firebase', 'Twilio']
  }
];
---

<section class="projects" id="proyectos" data-animate="section">
  <div class="projects__container">
    <div class="projects__header container">
      <span class="projects__badge">Portafolio</span>
      <h2 class="projects__title">Proyectos que transforman negocios</h2>
      <p class="projects__subtitle">Casos de éxito que demuestran el poder del software a la medida</p>
    </div>

    <div class="projects__scroll-container" data-projects-scroll>
      <!-- Scrolling Content Panel - LEFT SIDE -->
      <div class="projects__content-panel">
        {projects.map((project, index) => (
          <div 
            class="projects__slide" 
            data-project-slide={project.id}
            data-project-index={index}
          >
            <div class="projects__slide-content">
              <div class="projects__meta">
                <span class="projects__category">{project.category}</span>
                <span class="projects__year">{project.year}</span>
              </div>
              
              <h3 class="projects__project-title">{project.title}</h3>
              <p class="projects__client">Cliente: {project.client}</p>
              
              <div class="projects__details">
                <div class="projects__detail-block">
                  <h4 class="projects__detail-label">El Desafío</h4>
                  <p class="projects__detail-text">{project.challenge}</p>
                </div>
                
                <div class="projects__detail-block">
                  <h4 class="projects__detail-label">Nuestra Solución</h4>
                  <p class="projects__detail-text">{project.solution}</p>
                </div>
                
                <div class="projects__detail-block">
                  <h4 class="projects__detail-label">Resultados</h4>
                  <p class="projects__detail-text">{project.results}</p>
                </div>
              </div>
              
              <div class="projects__stats">
                {Object.entries(project.stats).map(([key, value]) => (
                  <div class="projects__stat">
                    <span class="projects__stat-value">{value}</span>
                    <span class="projects__stat-label">{key}</span>
                  </div>
                ))}
              </div>

              <div class="projects__tech">
                {project.technologies.map((tech) => (
                  <span class="projects__tech-tag">{tech}</span>
                ))}
              </div>
              
              <div class="projects__page-indicator">
                <span class="projects__page-current">{String(index + 1).padStart(2, '0')}</span>
                <span class="projects__page-separator">/</span>
                <span class="projects__page-total">{String(projects.length).padStart(2, '0')}</span>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- Fixed Image Panel - RIGHT SIDE -->
      <div class="projects__image-panel">
        <div class="projects__image-wrapper">
          {projects.map((project, index) => (
            <div 
              class={`projects__image ${index === 0 ? 'is-active' : ''}`} 
              data-project-image={project.id}
            >
              <img 
                src={project.image} 
                alt={project.title}
                loading={index === 0 ? 'eager' : 'lazy'}
              />
              <div class="projects__image-overlay"></div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .projects {
    background: var(--color-bg-tertiary);
    position: relative;
    padding: 0;
  }

  .projects__container {
    width: 100%;
  }

  .projects__header {
    text-align: center;
    padding-block: var(--space-16) var(--space-12);
  }

  .projects__badge {
    display: inline-block;
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--color-accent-cyan);
    background: rgba(0, 212, 255, 0.1);
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-radius: var(--radius-full);
    letter-spacing: var(--tracking-wide);
    text-transform: uppercase;
    margin-bottom: var(--space-4);
  }

  .projects__title {
    font-size: var(--text-4xl);
    font-weight: var(--font-bold);
    color: var(--color-text-primary);
    margin-bottom: var(--space-4);
  }

  .projects__subtitle {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    max-width: 500px;
    margin-inline: auto;
  }

  /* Scroll Container */
  .projects__scroll-container {
    position: relative;
    display: flex;
    min-height: 100vh;
  }

  /* Content Panel - LEFT SIDE, Scrollable */
  .projects__content-panel {
    width: 55%;
    display: flex;
    flex-direction: column;
    order: 1;
  }

  .projects__slide {
    min-height: 100vh;
    display: flex;
    align-items: flex-start;
    padding: var(--space-16) var(--space-12);
    padding-top: var(--space-20);
    opacity: 0.2;
    transform: translateY(30px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
  }

  .projects__slide.is-active {
    opacity: 1;
    transform: translateY(0);
  }

  .projects__slide-content {
    max-width: 560px;
    margin-left: auto;
  }

  .projects__meta {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    margin-bottom: var(--space-4);
  }

  .projects__category {
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--color-accent-purple);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
  }

  .projects__year {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }

  .projects__project-title {
    font-size: var(--text-3xl);
    font-weight: var(--font-bold);
    color: var(--color-text-primary);
    margin-bottom: var(--space-2);
    line-height: var(--leading-snug);
  }

  .projects__client {
    font-size: var(--text-sm);
    color: var(--color-text-tertiary);
    margin-bottom: var(--space-6);
  }

  .projects__details {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
    margin-bottom: var(--space-6);
  }

  .projects__detail-block {
    padding-left: var(--space-4);
    border-left: 2px solid var(--color-border);
    transition: border-color 0.3s ease;
  }

  .projects__slide.is-active .projects__detail-block:hover {
    border-left-color: var(--color-accent-cyan);
  }

  .projects__detail-label {
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--color-accent-cyan);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    margin-bottom: var(--space-2);
  }

  .projects__detail-text {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    line-height: var(--leading-relaxed);
  }

  .projects__stats {
    display: flex;
    gap: var(--space-6);
    margin-bottom: var(--space-6);
    padding-block: var(--space-4);
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
  }

  .projects__stat {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .projects__stat-value {
    font-size: var(--text-xl);
    font-weight: var(--font-bold);
    color: var(--color-accent-cyan);
  }

  .projects__stat-label {
    font-size: var(--text-xs);
    color: var(--color-text-tertiary);
    text-transform: capitalize;
  }

  .projects__tech {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-bottom: var(--space-6);
  }

  .projects__tech-tag {
    padding: var(--space-1) var(--space-3);
    font-size: var(--text-xs);
    color: var(--color-text-secondary);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
  }

  .projects__page-indicator {
    display: flex;
    align-items: baseline;
    gap: var(--space-2);
    font-family: var(--font-sans);
  }

  .projects__page-current {
    font-size: var(--text-xl);
    font-weight: var(--font-bold);
    color: var(--color-text-primary);
  }

  .projects__page-separator {
    font-size: var(--text-base);
    color: var(--color-text-muted);
  }

  .projects__page-total {
    font-size: var(--text-base);
    color: var(--color-text-muted);
  }

  /* Image Panel - RIGHT SIDE, Fixed during scroll */
  .projects__image-panel {
    position: sticky;
    top: 0;
    right: 0;
    width: 45%;
    height: 100vh;
    overflow: hidden;
    background: var(--color-bg-secondary);
    order: 2;
  }

  .projects__image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .projects__image {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    transform: scale(1.1) translateX(20px);
  }

  .projects__image.is-active {
    opacity: 1;
    transform: scale(1) translateX(0);
  }

  .projects__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .projects__image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      135deg,
      rgba(0, 212, 255, 0.1) 0%,
      rgba(139, 92, 246, 0.1) 100%
    );
    mix-blend-mode: overlay;
  }

  /* Mobile Layout */
  @media (max-width: 768px) {
    .projects__scroll-container {
      flex-direction: column;
    }

    .projects__content-panel {
      width: 100%;
      order: 2;
    }

    .projects__image-panel {
      position: relative;
      width: 100%;
      height: 50vh;
      order: 1;
    }

    .projects__slide {
      min-height: auto;
      padding: var(--space-8) var(--space-6);
    }

    .projects__slide-content {
      margin-left: 0;
    }

    .projects__stats {
      flex-wrap: wrap;
      gap: var(--space-4);
    }
  }
</style>

<script>
  // Projects scroll animation - Book flip effect
  const scrollContainer = document.querySelector('[data-projects-scroll]');
  const slides = document.querySelectorAll('[data-project-slide]');
  const images = document.querySelectorAll('[data-project-image]');

  if (scrollContainer && slides.length > 0) {
    const observerOptions = {
      root: null,
      rootMargin: '-35% 0px -35% 0px',
      threshold: 0
    };

    const handleIntersection = (entries: IntersectionObserverEntry[]) => {
      entries.forEach((entry) => {
        const slideId = (entry.target as HTMLElement).dataset.projectSlide;
        const correspondingImage = document.querySelector(`[data-project-image="${slideId}"]`);

        if (entry.isIntersecting) {
          // Activate this slide
          slides.forEach(s => s.classList.remove('is-active'));
          entry.target.classList.add('is-active');

          // Switch image with book-flip effect
          images.forEach(img => img.classList.remove('is-active'));
          correspondingImage?.classList.add('is-active');
        }
      });
    };

    const observer = new IntersectionObserver(handleIntersection, observerOptions);
    slides.forEach(slide => observer.observe(slide));

    // Activate first slide on load
    slides[0]?.classList.add('is-active');
  }
</script>
